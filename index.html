<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Winningtemp engagement assessment</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Google Tag Manager -->
    <script>
        (function(w, d, s, l, i) {
            w[l] = w[l] || [];
            w[l].push({
                'gtm.start': new Date().getTime(),
                event: 'gtm.js'
            });
            var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s),
                dl = l != 'dataLayer' ? '&l=' + l : '';
            j.async = true;
            j.src =
                'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
            f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-NF42R37');
    </script>
    <!-- End Google Tag Manager -->



    <style>
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            line-height: 150%;
        }

        .start-btn {
            background: #7f2696;
            color: white;
            border: none;
            border-radius: 50px;
            padding: 18px 36px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 12px;
        }

        .start-btn:hover {
            background: #6b2280;
        }

        .quiz-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 0;
        }

        .quiz-modal.active {
            display: flex;
        }

        .modal-content {
            background: transparent;
            border-radius: 0;
            width: 100%;
            max-width: 100%;
            max-height: 100vh;
            overflow-y: scroll;
            position: relative;
            padding: 20px;
        }

        /* Show scrollbar */
        .modal-content::-webkit-scrollbar {
            width: 8px;
        }

        .modal-content::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 4px;
        }

        .modal-content::-webkit-scrollbar-thumb {
            background: #7f2696;
            border-radius: 4px;
        }

        .modal-content::-webkit-scrollbar-thumb:hover {
            background: #6b2280;
        }

        @media (max-width: 768px) {
            .quiz-modal {
                padding: 0;
                align-items: flex-start;
            }

            .modal-content {
                border-radius: 0;
                max-height: 100vh;
                min-height: 0;
            }
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(127, 38, 150, 0.15);
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            color: #7f2696;
            z-index: 10;
        }

        .pin-icon {
            width: 96px;
            height: 96px;
            opacity: 0.9;
        }

        /* Hide scrollbar */
        .modal-content::-webkit-scrollbar .modal-content {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .smiley-icon {
            width: 24px;
            height: 24px;
            display: inline-block;
            margin-right: 8px;
        }
    </style>
</head>

<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NF42R37" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <!-- Quiz Modal -->
    <div id="quiz-modal" class="quiz-modal active">
        <div class="modal-content">
            <div id="quiz-root" style="padding: 0;"></div>
        </div>
    </div>

    <script>
        // Helper to safely extract a parameter from the URL query string
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            // We check the host page's URL for the 'market' parameter
            var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            var results = regex.exec(window.location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        // 1. Detect the Market Code
        // Check for 'market' in the URL query string (e.g., ?market=se). Default to 'GLOBAL'.
        let detectedMarket = getUrlParameter('market') || 'GLOBAL';

        // 2. Push the market code to the Data Layer immediately
        // The key 'market' now MATCHES the name your GA4 Configuration Tag expects.
        window.dataLayer = window.dataLayer || [];
        window.dataLayer.push({
            'event': 'market_code_set',
            'market': detectedMarket // <--- THIS IS THE CORRECTED NAME
        });

        // Console output for debugging (check your browser console when testing)
        console.log('Detected Market:', detectedMarket);
        console.log('Market code pushed to DataLayer: market =', detectedMarket);
        console.log('Quiz script loading...');

        // Google Analytics 4 and GTM Tracking Functions
        function gtag() {
            dataLayer.push(arguments);
        }

        // Track quiz events
        function trackQuizEvent(eventName, parameters = {}) {
            // GTM DataLayer push
            window.dataLayer = window.dataLayer || [];
            window.dataLayer.push({
                'event': eventName,
                'quiz_type': 'employee_engagement_assessment',
                'page_url': window.location.href,
                'timestamp': new Date().toISOString(),
                ...parameters
            });

            // GA4 gtag (if available)
            if (typeof gtag !== 'undefined') {
                gtag('event', eventName, {
                    'custom_parameter_1': 'employee_engagement_assessment',
                    'custom_parameter_2': window.location.href,
                    ...parameters
                });
            }

            console.log('Tracked event:', eventName, parameters);
        }

        // Track quiz start
        function trackQuizStart() {
            trackQuizEvent('quiz_start', {
                'quiz_name': 'Employee Engagement Assessment',
                'quiz_version': '1.0'
            });

            // Send to parent page via postMessage
            try {
                window.parent.postMessage(JSON.stringify({
                    'event': 'quiz_start',
                    'quiz_type': 'employee_engagement_assessment',
                    'quiz_name': 'Employee Engagement Assessment',
                    'quiz_version': '1.0',
                    'page_url': window.location.href,
                    'page_title': document.title
                }), '*');
                console.log('quiz_start event sent to parent page');
            } catch (e) {
                console.error("Failed to send quiz_start postMessage:", e);
            }
        }

        // Track question answered
        function trackQuestionAnswered(questionNumber, answer, questionText) {
            trackQuizEvent('quiz_question_answered', {
                'question_number': questionNumber,
                'question_text': questionText,
                'answer_value': answer,
                'answer_label': getAnswerLabel(answer)
            });
        }

        // Track quiz completion
        function trackQuizCompletion(results) {
            trackQuizEvent('quiz_completed', {
                'quiz_score': results.aCount,
                'total_questions': results.totalQuestions,
                'result_type': results.resultType,
                'completion_time': Date.now() - quizStartTime,
                'answers': results.breakdown.map(q => ({
                    question: q.question,
                    answer: q.selected,
                    score: q.score
                }))
            });
        }

        // Track PDF download
        function trackPDFDownload() {
            trackQuizEvent('pdf_download', {
                'download_type': 'engagement_assessment_report',
                'file_format': 'pdf'
            });
        }

        // Track workbook download
        function trackWorkbookDownload() {
            trackQuizEvent('workbook_download', {
                'download_type': 'step_by_step_workbook',
                'file_format': 'pdf'
            });
        }

        // Track form submission
        function trackFormSubmission(email, firstName, lastName, marketingConsent, dataProcessingConsent) {
            trackQuizEvent('quiz_submission', {
                'form_type': 'quiz_results_request',
                'has_email': !!email,
                'has_first_name': !!firstName,
                'has_last_name': !!lastName,
                'marketing_consent': marketingConsent,
                'data_processing_consent': dataProcessingConsent,
                'lead_quality': 'high' // Quiz completers are high-quality leads
            });
        }

        // Helper function to get answer labels
        function getAnswerLabel(answer) {
            const labels = {
                'A': 'Advanced',
                'B': 'Developing',
                'C': 'Basic',
                'D': 'Minimal'
            };
            return labels[answer] || answer;
        }

        // Track page view
        function trackPageView() {
            trackQuizEvent('page_view', {
                'page_title': 'Employee Engagement Assessment',
                'page_location': window.location.href
            });
        }

        // Initialize tracking
        let quizStartTime = Date.now();
        trackPageView();

        // Quiz data
        const questions = [{
                question: "How ofter does your organization measure employee engagement through surveys being sent to your employees?",
                options: [{
                        text: "Weekly or every two weeks with continuous surveys",
                        value: "A"
                    },
                    {
                        text: "Quarterly or monthly",
                        value: "B"
                    },
                    {
                        text: "Annually",
                        value: "C"
                    },
                    {
                        text: "Rarely or never",
                        value: "D"
                    }
                ],
                why: "Real-time insights help you spot challenges before they escalate into costly turnover."
            },
            {
                question: "When engagement issues arise, how quickly can your leadership team identify and respond?",
                options: [{
                        text: "Within days - we have real-time dashboards",
                        value: "A"
                    },
                    {
                        text: "Within a few weeks",
                        value: "B"
                    },
                    {
                        text: "Within 1-3 months",
                        value: "C"
                    },
                    {
                        text: "We often don't know there's a problem until exit interviews",
                        value: "D"
                    }
                ],
                why: "Speed matters. Organizations that act fast on feedback see 25% higher retention rates."
            },
            {
                question: "How confident are your managers in taking action based on employee feedback?",
                options: [{
                        text: "Very confident - they receive AI-powered, research-based recommendations",
                        value: "A"
                    },
                    {
                        text: "Somewhat confident - they get data but limited guidance",
                        value: "B"
                    },
                    {
                        text: "Not very confident - they're unsure what actions to take",
                        value: "C"
                    },
                    {
                        text: "They don't receive regular feedback to act on",
                        value: "D"
                    }
                ],
                why: "Data without actionable insights leads to analysis paralysis and missed opportunities."
            },
            {
                question: "What's your current employee response rate to engagement surveys?",
                options: [{
                        text: "Over 70%",
                        value: "A"
                    },
                    {
                        text: "30-70%",
                        value: "B"
                    },
                    {
                        text: "1-29%",
                        value: "C"
                    },
                    {
                        text: "I don't know or we don't survey regularly",
                        value: "D"
                    }
                ],
                why: "Low response rates indicate survey fatigue or lack of trust that action will be taken."
            },
            {
                question: "To what extent does your organization understand the connection between employee engagement and business outcomes?",
                options: [{
                        text: "Fully",
                        value: "A"
                    },
                    {
                        text: "Largely",
                        value: "B"
                    },
                    {
                        text: "Somewhat",
                        value: "C"
                    },
                    {
                        text: "Not at all",
                        value: "D"
                    }
                ],
                why: "Engaged teams perform better - this should be a strategic business metric, not just an HR initiative."
            },
            {
                question: "Does your organization track the connection between employee engagement and business outcomes?",
                options: [{
                        text: "Yes, we have clear metrics linking engagement to KPIs",
                        value: "A"
                    },
                    {
                        text: "We track both separately but haven't connected them",
                        value: "B"
                    },
                    {
                        text: "We only track business metrics",
                        value: "C"
                    },
                    {
                        text: "We don't measure engagement consistently",
                        value: "D"
                    }
                ],
                why: "Engaged teams perform better - this should be a strategic business metric, not just an HR initiative."
            },
            {
                question: "How much time do you — or the person responsible for employee feedback surveys — spend on administrative survey tasks compared to strategic action?",
                options: [{
                        text: "Mostly strategic - our platform automates the admin work",
                        value: "A"
                    },
                    {
                        text: "50/50 split",
                        value: "B"
                    },
                    {
                        text: "Mostly admin - surveys take significant manual effort",
                        value: "C"
                    },
                    {
                        text: "We lack resources for comprehensive engagement programs",
                        value: "D"
                    }
                ],
                why: "HR should drive strategy, not get buried in spreadsheets. Automation frees up 15+ hours per month."
            },
            {
                question: "Can your leadership team identify which specific factors are driving engagement in different teams?",
                options: [{
                        text: "Yes, we have granular insights by team, department, and demographic",
                        value: "A"
                    },
                    {
                        text: "We have organization-wide data but limited team-level detail",
                        value: "B"
                    },
                    {
                        text: "We have general insights but can't pinpoint specific drivers",
                        value: "C"
                    },
                    {
                        text: "We don't have this level of visibility",
                        value: "D"
                    }
                ],
                why: "One-size-fits-all solutions don't work. Different teams have different needs."
            },
            {
                question: "How does your organization handle anonymous feedback?",
                options: [{
                        text: "We have a secure platform for continuous anonymous input",
                        value: "A"
                    },
                    {
                        text: "We collect anonymous surveys occasionally",
                        value: "B"
                    },
                    {
                        text: "Most feedback requires identification",
                        value: "C"
                    },
                    {
                        text: "We don't have a formal anonymous feedback mechanism",
                        value: "D"
                    }
                ],
                why: "Psychological safety drives honest feedback - anonymity is critical for sensitive issues."
            },
            {
                question: "What happens after you collect employee feedback?",
                options: [{
                        text: "We get AI-powered action recommendations and track progress",
                        value: "A"
                    },
                    {
                        text: "Managers review results and decide on actions independently",
                        value: "B"
                    },
                    {
                        text: "HR compiles reports but follow-through is inconsistent",
                        value: "C"
                    },
                    {
                        text: "The data sits in spreadsheets with minimal action",
                        value: "D"
                    }
                ],
                why: "Collecting feedback without action destroys trust and worsens engagement."
            },
            {
                question: "How well can your organization predict potential retention risks?",
                options: [{
                        text: "Very well - we have early warning indicators and trend analysis",
                        value: "A"
                    },
                    {
                        text: "Somewhat - we notice patterns but can't predict accurately",
                        value: "B"
                    },
                    {
                        text: "Not well - we're usually surprised by resignations",
                        value: "C"
                    },
                    {
                        text: "We don't have predictive capabilities",
                        value: "D"
                    }
                ],
                why: "Replacing an employee costs 1.5-2x their annual salary. Prevention is far cheaper than reaction."
            },
            {
                question: "Does your employee engagement strategy support leaders in creating psychologically safe environments?",
                options: [{
                        text: "Yes, we provide tools, training, and data-driven guidance",
                        value: "A"
                    },
                    {
                        text: "We provide some training but limited ongoing support",
                        value: "B"
                    },
                    {
                        text: "It's mentioned but not actively supported with tools",
                        value: "C"
                    },
                    {
                        text: "This isn't currently a focus area",
                        value: "D"
                    }
                ],
                why: "Psychological safety is the foundation of engagement, innovation, and team performance."
            },
            {
                question: "How aligned are your organization's engagement efforts with scientific research and best practices?",
                options: [{
                        text: "Highly aligned - the platform we use is research-based and continuously updated",
                        value: "A"
                    },
                    {
                        text: "Somewhat aligned - we follow general best practices",
                        value: "B"
                    },
                    {
                        text: "Limited alignment - we use intuition more than research",
                        value: "C"
                    },
                    {
                        text: "We're not sure what current best practices are",
                        value: "D"
                    }
                ],
                why: "Science-backed approaches deliver measurable results. Guesswork leads to wasted resources."
            }
        ];

        // State
        let currentQuestion = -1; // Start with intro
        let answers = {};

        // DOM Elements
        const modal = document.getElementById('quiz-modal');
        const quizRoot = document.getElementById('quiz-root');



        // Smiley SVG functions for each option
        function getSmileyIcon(option) {
            const smileys = {
                'A': `<svg class="smiley-icon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" fill="none">
                    <circle cx="18" cy="18" r="18" fill="#45CB1C"></circle>
                    <path fill="white" fill-opacity="0.7" fill-rule="evenodd" clip-rule="evenodd" d="M10.6301 5.5829C7.91034 8.51058 6 13.547 6 19C6 22.2986 6.66319 25.3779 7.81098 27.9847C8.48158 29.5077 7.51669 30.1983 6.38454 29.0037C3.66694 26.136 2 22.2626 2 18C2 12.2419 5.04407 7.21939 9.60581 4.37613C10.9353 3.54747 11.4473 4.70319 10.6301 5.5829Z"></path>
                    <path d="M24.0012 23.1752C24.0012 26.4885 21.3153 29.1744 18.002 29.1744C14.8151 29.1744 12.2085 26.6894 12.0144 23.5514C11.9745 22.9067 12.3179 22.5867 12.7701 22.5709C17.3549 22.4071 20.7935 22.2842 23.0859 22.2023C23.9304 22.1721 24.0012 22.8337 24.0012 23.1752Z" fill="#353A40"></path>
                    <path d="M9.2931 14.5209C10.711 14.3216 12.0268 15.344 12.232 16.8043C12.4299 18.2125 11.2844 18.1521 9.93097 18.3246L9.7798 18.3448C8.36191 18.5441 7.30265 18.9863 7.09741 17.5259C6.89217 16.0656 7.87521 14.7202 9.2931 14.5209Z" fill="#353A40"></path>
                    <path d="M25.8329 14.5209C27.2507 14.7202 28.2338 16.0656 28.0285 17.5259C27.8306 18.9342 26.8386 18.5733 25.4967 18.367L25.3462 18.3448C23.9283 18.1456 22.6887 18.2647 22.8939 16.8043C23.0992 15.344 24.415 14.3216 25.8329 14.5209Z" fill="#353A40"></path>
                </svg>`,
                'B': `<svg class="smiley-icon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" fill="none">
                    <circle cx="18" cy="18" r="18" fill="#B3E818"></circle>
                    <path fill="white" fill-opacity="0.7" fill-rule="evenodd" clip-rule="evenodd" d="M10.6301 5.5829C7.91034 8.51058 6 13.547 6 19C6 22.2986 6.66319 25.3779 7.81098 27.9847C8.48158 29.5077 7.51669 30.1983 6.38454 29.0037C3.66694 26.136 2 22.2626 2 18C2 12.2419 5.04407 7.21939 9.60581 4.37613C10.9353 3.54747 11.4473 4.70319 10.6301 5.5829Z"></path>
                    <path d="M23.8968 24.7197C24.2658 25.0426 24.3032 25.6036 23.9803 25.9727C21.9496 28.2934 19.5691 28.9113 17.4719 28.6866C15.4317 28.468 13.6794 27.4575 12.7601 26.5382C12.4133 26.1914 12.4133 25.6292 12.7601 25.2824C13.1068 24.9356 13.6691 24.9356 14.0158 25.2824C14.6635 25.9301 16.0451 26.7477 17.6611 26.9208C19.2202 27.0878 21.0182 26.6611 22.6438 24.8032C22.9667 24.4342 23.5277 24.3968 23.8968 24.7197Z" fill="#353A40"></path>
                    <path d="M10.45 15.6C11.8031 15.6 12.9 16.6969 12.9 18.05C12.9 19.4031 11.8031 20.5 10.45 20.5C9.0969 20.5 8 19.4031 8 18.05C8 16.6969 9.0969 15.6 10.45 15.6Z" fill="#353A40"></path>
                    <path d="M25.45 15.6C26.8031 15.6 27.9 16.6969 27.9 18.05C27.9 19.4031 26.8031 20.5 25.45 20.5C24.0969 20.5 23 19.4031 23 18.05C23 16.6969 24.0969 15.6 25.45 15.6Z" fill="#353A40"></path>
                </svg>`,
                'C': `<svg class="smiley-icon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" fill="none">
                    <circle cx="18" cy="18" r="18" fill="#FFA000"></circle>
                    <path fill="white" fill-opacity="0.7" fill-rule="evenodd" clip-rule="evenodd" d="M10.6301 5.58296C7.91034 8.51064 6 13.5471 6 19C6 22.2987 6.66319 25.3779 7.81098 27.9847C8.48158 29.5078 7.51669 30.1984 6.38454 29.0037C3.66694 26.136 2 22.2627 2 18C2 12.242 5.04407 7.21945 9.60581 4.37619C10.9353 3.54753 11.4473 4.70325 10.6301 5.58296Z"></path>
                    <path d="M14.5 27.7001C16.5 26.2001 20.5 25.2001 25 26.4001" stroke="#353A40" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" fill="none"></path>
                    <path d="M10.9502 14.9001C12.1928 14.9001 13.2002 15.9074 13.2002 17.1501C13.2002 18.3927 12.1928 19.4001 10.9502 19.4001C9.70755 19.4001 8.7002 18.3927 8.7002 17.1501C8.7002 15.9074 9.70755 14.9001 10.9502 14.9001Z" fill="#353A40"></path>
                    <path d="M26.4502 14.9001C27.6928 14.9001 28.7002 15.9074 28.7002 17.1501C28.7002 18.3927 27.6928 19.4001 26.4502 19.4001C25.2076 19.4001 24.2002 18.3927 24.2002 17.1501C24.2002 15.9074 25.2076 14.9001 26.4502 14.9001Z" fill="#353A40"></path>
                </svg>`,
                'D': `<svg class="smiley-icon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" fill="none">
                    <circle cx="18" cy="18" r="18" fill="#FF5C61"></circle>
                    <path fill="white" fill-opacity="0.7" fill-rule="evenodd" clip-rule="evenodd" d="M10.63 5.583C7.91 8.511 6 13.547 6 19C6 22.299 6.663 25.378 7.811 27.985C8.482 29.508 7.517 30.198 6.385 29.004C3.667 26.136 2 22.263 2 18C2 12.242 5.044 7.219 9.606 4.376C10.935 3.548 11.447 4.703 10.63 5.583Z"></path>
                    <path d="M14 29.2C17 27.7 20 26.3 24.7 28.4" stroke="#353A40" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" fill="none"></path>
                    <path d="M9.457 17.523L11.864 17.948C12.677 18.091 13.221 18.867 13.077 19.681C12.934 20.495 12.158 21.038 11.344 20.895L8.937 20.47C8.123 20.327 7.58 19.551 7.723 18.737C7.867 17.923 8.643 17.38 9.457 17.523Z" fill="#353A40"></path>
                    <path d="M28.713 17.523C29.527 17.38 30.303 17.923 30.446 18.737C30.581 19.503 30.108 20.235 29.373 20.438L29.233 20.47L26.826 20.895C26.012 21.038 25.236 20.495 25.092 19.681C24.957 18.915 25.431 18.182 26.165 17.979L26.306 17.948L28.713 17.523Z" fill="#353A40"></path>
                </svg>`
            };
            return smileys[option] || '';
        }

        // Functions

        function renderIntro() {
            quizRoot.innerHTML = `
        <div class="intro-container" style="text-align: center; max-width: 500px; margin: 0 auto; padding: 0 10px; display: flex; flex-direction: column; align-items: center;">
          <img src="https://raw.githubusercontent.com/Nico-Winningtemp/Questionnaire/refs/heads/main/logo.svg" alt="Winningtemp" class="intro-logo" style="max-height: 120px; width: auto; margin-bottom: 25px; display: block; filter: drop-shadow(0 4px 8px rgba(127, 38, 150, 0.2));">
          
          <h1 class="intro-title" style="font-size: 2.2rem; font-weight: 500; color: #100014; margin: 0 0 10px 0; line-height: 120%; font-family: 'Poppins', sans-serif !important;">
            Let's measure your engagement maturity
          </h1>
          
          <p class="intro-description" style="font-size: 14px; color: #18181B; margin-bottom: 20px; line-height: 1.4; font-family: 'Poppins', sans-serif;">
            This assessment will help you understand your organization’s current level of employee listening maturity and identify opportunities for improvement.
          </p>
          
          <div class="how-it-works" style="background: rgba(127, 38, 150, 0.05); border: 1px solid rgba(127, 38, 150, 0.1); border-radius: 12px; padding: 15px; margin-bottom: 20px; text-align: left;">
            <h3 class="how-title" style="color: #7f2696; margin-bottom: 10px; font-size: 16px; text-align: center; font-family: 'Poppins', sans-serif;">How This Works</h3>
            <p class="how-description" style="color: #1e293b; margin-bottom: 10px; font-size: 12px; text-align: center; font-family: 'Poppins', sans-serif;">You'll answer questions about your organization's engagement practices. Each has four options:</p>
            
            <div class="options-grid" style="display: grid; gap: 6px; margin-bottom: 10px;">
              <div class="option-item" style="display: flex; align-items: center; padding: 8px; background: rgba(5, 150, 105, 0.05); border-radius: 4px;">
                <div class="option-circle" style="width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; margin-right: 8px;">${getSmileyIcon('A')}</div>
                <div class="option-text" style="font-size: 11px; font-family: 'Poppins', sans-serif;"><strong>Advanced:</strong> Sophisticated, data-driven practices</div>
              </div>
              <div class="option-item" style="display: flex; align-items: center; padding: 8px; background: rgba(2, 132, 199, 0.05); border-radius: 4px;">
                <div class="option-circle" style="width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; margin-right: 8px;">${getSmileyIcon('B')}</div>
                <div class="option-text" style="font-size: 11px; font-family: 'Poppins', sans-serif;"><strong>Developing:</strong> Some systems in place</div>
              </div>
              <div class="option-item" style="display: flex; align-items: center; padding: 8px; background: rgba(234, 88, 12, 0.05); border-radius: 4px;">
                <div class="option-circle" style="width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; margin-right: 8px;">${getSmileyIcon('C')}</div>
                <div class="option-text" style="font-size: 11px; font-family: 'Poppins', sans-serif;"><strong>Basic:</strong> Limited measurement and insights</div>
              </div>
              <div class="option-item" style="display: flex; align-items: center; padding: 8px; background: rgba(220, 38, 38, 0.05); border-radius: 4px;">
                <div class="option-circle" style="width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; margin-right: 8px;">${getSmileyIcon('D')}</div>
                <div class="option-text" style="font-size: 11px; font-family: 'Poppins', sans-serif;"><strong>Minimal:</strong> Little to no systematic approach</div>
              </div>
            </div>
          </div>
          
          <button onclick="startQuestions()" class="start-button" style="background: #7f2696; color: white; border: none; border-radius: 50px; padding: 12px 24px; font-size: 14px; font-weight: 600; cursor: pointer; transition: background 0.3s ease; font-family: 'Poppins', sans-serif;">
            Let's Get Started →
          </button>
        </div>
        
        <style>
          @media (max-width: 768px) {
            .intro-container {
              padding: 0 10px !important;
            }
            
            .intro-logo {
              max-height: 80px !important;
              margin-bottom: 20px !important;
            }
            
            .intro-title {
              font-size: 24px !important;
              margin-bottom: 12px !important;
            }
            
            .intro-description {
              font-size: 14px !important;
              margin-bottom: 20px !important;
            }
            
            .how-it-works {
              padding: 20px !important;
              margin-bottom: 20px !important;
              border-radius: 12px !important;
            }
            
            .how-title {
              font-size: 16px !important;
              margin-bottom: 12px !important;
            }
            
            .how-description {
              font-size: 13px !important;
              margin-bottom: 10px !important;
            }
            
            .options-grid {
              gap: 8px !important;
              margin-bottom: 12px !important;
            }
            
            .option-item {
              padding: 10px !important;
            }
            
            .option-circle {
              width: 24px !important;
              height: 24px !important;
              font-size: 11px !important;
              margin-right: 8px !important;
            }
            
            .option-text {
              font-size: 12px !important;
            }
            
            .start-button {
              padding: 14px 28px !important;
              font-size: 15px !important;
            }
          }
          
          @media (max-width: 480px) {
            .intro-title {
              font-size: 22px !important;
            }
            
            .intro-description {
              font-size: 13px !important;
            }
            
            .how-it-works {
              padding: 15px !important;
            }
            
            .how-title {
              font-size: 15px !important;
            }
            
            .how-description {
              font-size: 12px !important;
            }
            
            .option-text {
              font-size: 11px !important;
            }
            
            .start-button {
              padding: 12px 24px !important;
              font-size: 14px !important;
            }
          }
        </style>
      `;
        }

        function startQuestions() {
            currentQuestion = 0;
            trackQuizStart();
            renderQuestion();
        }

        function renderQuestion() {
            if (currentQuestion >= questions.length) {
                showResults();
                return;
            }

            const question = questions[currentQuestion];
            const progress = ((currentQuestion + 1) / questions.length) * 100;

            quizRoot.innerHTML = `
        <div style="max-width: 700px; margin: 0 auto; padding: 0 10px;">
          <div style="text-align: center; margin-bottom: 20px; display: flex; flex-direction: column; align-items: center;">
            <img src="https://raw.githubusercontent.com/Nico-Winningtemp/Questionnaire/refs/heads/main/logo.svg" alt="Winningtemp" style="max-height: 80px; width: auto; margin-bottom: 15px; display: block;">
            <p style="color: #1e293b; font-size: 14px;">Question ${currentQuestion + 1} of ${questions.length} • ${Math.round(progress)}% Complete</p>
          </div>
          
          <div style="margin-bottom: 15px;">
            <div style="height: 6px; background: #f1f5f9; border-radius: 3px; overflow: hidden;">
              <div style="height: 100%; background: linear-gradient(90deg, #7f2696 0%, #9333ea 100%); transition: width 0.5s ease; border-radius: 3px; width: ${progress}%"></div>
            </div>
          </div>
          
          <div class="question-card" style="background: white; border-radius: 16px; padding: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.08); border: 1px solid rgba(127, 38, 150, 0.1);">
            <h2 class="question-title" style="font-size: 18px; font-weight: 600; color: #1e293b; margin: 0 0 15px 0; line-height: 1.3; font-family: 'Poppins', sans-serif;">${question.question}</h2>
            
            <div style="margin-bottom: 15px;">
              ${question.options.map((option, index) => `
                <button onclick="selectAnswer('${option.value}')" class="option-btn" style="width: 100%; margin-bottom: 8px; padding: 12px; border: 2px solid rgba(127, 38, 150, 0.1); border-radius: 10px; background: white; cursor: pointer; text-align: left; display: flex; align-items: flex-start; transition: all 0.3s ease;" onmouseover="this.style.borderColor='#7f2696'; this.style.backgroundColor='rgba(127, 38, 150, 0.03)'" onmouseout="this.style.borderColor='rgba(127, 38, 150, 0.1)'; this.style.backgroundColor='white'">
                  <div class="option-circle" style="width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; margin-right: 10px; flex-shrink: 0;">
                    ${getSmileyIcon(option.value)}
                  </div>
                  <span class="option-text" style="font-size: 13px; color: #1e293b; line-height: 1.4; flex: 1; font-family: 'Poppins', sans-serif;">${option.text}</span>
                </button>
              `).join('')}
            </div>
            
            <div class="why-matters" style="background: rgba(127, 38, 150, 0.05); border: 1px solid rgba(127, 38, 150, 0.1); border-radius: 8px; padding: 12px;">
              <div style="display: flex; align-items: center; margin-bottom: 6px;">
                <img src="https://raw.githubusercontent.com/Nico-Winningtemp/Questionnaire/refs/heads/main/pinLogo.svg" style="width: 14px; height: 14px; margin-right: 5px;" alt="">
                <div class="why-title" style="font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; color: #7f2696; font-family: 'Poppins', sans-serif;">Why this matters</div>
              </div>
              <p class="why-text" style="font-size: 12px; color: #1e293b; margin: 0; line-height: 1.3; font-family: 'Poppins', sans-serif;">${question.why}</p>
            </div>
          </div>
          
          <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px; padding: 0 10px;">
            <button onclick="previousQuestion()" ${currentQuestion === 0 ? 'disabled style="opacity: 0.4; cursor: not-allowed;"' : ''} class="prev-btn" style="background: transparent; color: #1e293b; border: 2px solid rgba(127, 38, 150, 0.2); border-radius: 50px; padding: 10px 20px; font-weight: 500; cursor: pointer; font-size: 14px; font-family: 'Poppins', sans-serif;">
              ← Previous
            </button>
          </div>
        </div>
        
        <style>
          @media (max-width: 768px) {
            .question-card {
              padding: 15px !important;
              border-radius: 12px !important;
            }
            
            .question-title {
              font-size: 16px !important;
              margin-bottom: 12px !important;
            }
            
            .option-btn {
              padding: 10px !important;
              margin-bottom: 6px !important;
            }
            
            .option-circle {
              width: 24px !important;
              height: 24px !important;
              font-size: 10px !important;
              margin-right: 8px !important;
            }
            
            .option-text {
              font-size: 12px !important;
            }
            
            .why-matters {
              padding: 10px !important;
            }
            
            .why-title {
              font-size: 11px !important;
            }
            
            .why-text {
              font-size: 11px !important;
            }
            
            .prev-btn {
              padding: 8px 16px !important;
              font-size: 12px !important;
            }
          }
          
          @media (max-width: 480px) {
            .question-card {
              padding: 12px !important;
            }
            
            .question-title {
              font-size: 15px !important;
            }
            
            .option-text {
              font-size: 11px !important;
            }
            
            .why-text {
              font-size: 10px !important;
            }
          }
        </style>
      `;
        }

        function selectAnswer(value) {
            answers[currentQuestion] = value;

            // Track question answered
            const question = questions[currentQuestion];
            trackQuestionAnswered(currentQuestion + 1, value, question.question);

            currentQuestion++;
            setTimeout(renderQuestion, 300);
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                renderQuestion();
            } else {
                currentQuestion = -1;
                renderIntro();
            }
        }

        function toggleFeature(index) {
            const content = document.getElementById(`feature-${index}`);
            const arrow = document.getElementById(`arrow-${index}`);

            if (content.style.display === 'none') {
                content.style.display = 'block';
                arrow.style.transform = 'rotate(180deg)';
                arrow.innerHTML = '▲';
            } else {
                content.style.display = 'none';
                arrow.style.transform = 'rotate(0deg)';
                arrow.innerHTML = '▼';
            }
        }

        function shareResults(platform) {
            const counts = {
                A: 0,
                B: 0,
                C: 0,
                D: 0
            };
            Object.values(answers).forEach(answer => {
                counts[answer]++;
            });

            const aCount = counts.A;
            let resultType = '';
            if (aCount >= 9) resultType = 'Engagement Champion';
            else if (aCount >= 5) resultType = 'Growing Foundation';
            else if (aCount >= 3) resultType = 'Critical Gap Zone';
            else resultType = 'Urgent Action Needed';

            const text = `I just completed Winningtemp's employee engagement assessment and scored as "${resultType}" with ${aCount} out of 12 A's. See how your organization measures up!`;
            const url = 'https://winningtemp.com/assessment';

            switch (platform) {
                case 'linkedin':
                    window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(url)}&text=${encodeURIComponent(text)}`);
                    break;
                case 'twitter':
                    window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`);
                    break;
            }
        }

        function emailResults() {
            const email = document.getElementById('results-email').value;
            const marketingConsent = document.getElementById('marketing-consent').checked;

            if (!email) {
                alert('Please enter your email address');
                return;
            }

            const resultsData = generateResultsData();

            // Simulate sending email (replace with actual backend call)
            console.log('Sending results to:', email, resultsData);

            // Show confirmation
            alert('Your detailed results report has been sent to ' + email + '!\\n\\nYour report includes:\\n• Your complete assessment responses\\n• Detailed analysis of each answer\\n• Personalized recommendations\\n• Next steps for improvement\\n• Professional PDF report\\n• Executive slide deck');

            // Log for CRM integration
            console.log('Lead captured with results:', {
                email: email,
                results: resultsData,
                marketingConsent: marketingConsent,
                timestamp: new Date().toISOString()
            });

            // If marketing consent is given, add to marketing list
            if (marketingConsent) {
                console.log('User opted into marketing emails:', email);
                // Here you would typically send this to your marketing automation system
                // Example: addToMarketingList(email, resultsData);
            }
        }

        function renderResults() {
            const results = generateResultsData();

            // Track quiz completion
            trackQuizCompletion(results);

            quizRoot.innerHTML = `
                <div class="results-container" style="max-width: 800px; margin: 0 auto; padding: 20px; text-align: center;">
                    <img src="https://raw.githubusercontent.com/Nico-Winningtemp/Questionnaire/refs/heads/main/logo.svg" alt="Winningtemp" style="max-height: 50px; margin-bottom: 15px;">
                    
                    <h1 style="font-size: 2rem; font-weight: 700; color: #7f2696; margin-bottom: 10px;">Your Engagement Maturity Result</h1>
                    <p style="font-size: 16px; color: #4b5563; margin-bottom: 30px;">See your score and detailed breakdown below.</p>

                    <div class="result-box" style="padding: 30px; border-radius: 12px; background: ${results.resultColor}; color: white; margin-bottom: 30px; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);">
                        <div style="font-size: 3rem; font-weight: 800; line-height: 1;">${results.aCount}</div>
                        <div style="font-size: 1.1rem; font-weight: 500; margin-bottom: 15px;">'Advanced' Answers out of ${results.totalQuestions}</div>
                        <h2 style="font-size: 2.2rem; font-weight: 700; margin: 0 0 10px 0;">${results.resultType}</h2>
                        <p style="font-size: 16px; font-weight: 400; max-width: 600px; margin: 0 auto;">${results.resultDescription}</p>
                    </div>

                    <div class="breakdown-section" style="text-align: left; margin-top: 40px;">
                        <h3 style="font-size: 1.8rem; color: #1e293b; border-bottom: 2px solid #f3f4f6; padding-bottom: 10px; margin-bottom: 20px;">Detailed Analysis</h3>
                        
                        ${results.breakdown.map((item, index) => `
                            <div class="question-result-item" style="margin-bottom: 30px; padding: 15px; border-left: 5px solid #7f2696; background: #f9fafb; border-radius: 8px;">
                                <p style="font-weight: 600; color: #7f2696; margin-bottom: 5px;">Question ${index + 1}:</p>
                                <p style="font-weight: 500; color: #1e293b; margin-bottom: 10px;">${item.question}</p>
                                <div style="display: flex; justify-content: space-between; font-size: 14px; margin-bottom: 10px;">
                                    <span style="font-weight: 600; color: #4b5563;">Your Answer:</span>
                                    <span style="color: #4b5563;">${item.selected} (${item.score})</span>
                                </div>
                                <div style="font-size: 14px; color: #4b5563; border-top: 1px dashed #e5e7eb; padding-top: 10px;">
                                    <span style="font-weight: 600; color: #1e293b;">Why it matters:</span> ${item.why}
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <div id="main-download-section" style="margin-top: 40px; border-top: 1px solid #e5e7eb; padding-top: 20px; display: none; flex-direction: column; align-items: center; gap: 15px;">
                        <p style="color: #4b5563; font-size: 14px; margin: 0; text-align: center;">Please provide your email and consent to access your downloads</p>
                        <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                            <button onclick="downloadPDF()" class="download-btn" style="background: #7f2696; color: white; border: none; border-radius: 8px; padding: 12px 24px; font-size: 14px; font-weight: 600; cursor: pointer; transition: background 0.3s ease; display: inline-flex; align-items: center; gap: 8px; font-family: 'Poppins', sans-serif;" onmouseover="this.style.background='#6b2280'" onmouseout="this.style.background='#7f2696'">
                                Download PDF Report
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-download"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                            </button>
                            <button onclick="downloadWorkbook()" class="workbook-btn" style="background: #059669; color: white; border: none; border-radius: 8px; padding: 12px 24px; font-size: 14px; font-weight: 600; cursor: pointer; transition: background 0.3s ease; display: inline-flex; align-items: center; gap: 8px; font-family: 'Poppins', sans-serif;" onmouseover="this.style.background='#047857'" onmouseout="this.style.background='#059669'">
                                Download Step-by-Step Workbook
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-book"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function downloadPDF() {
            // Check if user has provided email and consent
            if (!checkDownloadRequirements()) {
                return;
            }

            // Track PDF download
            trackPDFDownload();

            console.log('Starting PDF generation...');
            const resultsData = generateResultsData();
            console.log('Results data generated:', resultsData);

            try {
                // Check if jsPDF is available
                console.log('Checking jsPDF availability...');
                console.log('window.jspdf:', typeof window.jspdf);
                console.log('window.jsPDF:', typeof window.jsPDF);

                if (typeof window.jspdf === 'undefined') {
                    console.error('jsPDF library not found on window.jspdf');
                    throw new Error('jsPDF library not loaded. Please refresh the page and try again.');
                }

                const {
                    jsPDF
                } = window.jspdf;
                console.log('jsPDF constructor:', typeof jsPDF);
                const doc = new jsPDF('p', 'pt', 'a4');
                console.log('PDF document created successfully');

                // Winningtemp brand colors (RGB)
                const brandPurple = [128, 38, 150];
                const lightPurple = [248, 244, 255];
                const darkGray = [30, 41, 59];
                const mediumGray = [100, 116, 139];
                const accentGreen = [5, 150, 105];
                const accentBlue = [2, 132, 199];
                const accentOrange = [234, 88, 12];
                const accentRed = [220, 38, 38];

                let currentY = 40;
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                const margin = 45;
                const contentWidth = pageWidth - (2 * margin);

                // Helper: Check page break
                function checkPageBreak(neededHeight = 60) {
                    if (currentY + neededHeight > pageHeight - 60) {
                        addFooter();
                        doc.addPage();
                        currentY = 40;
                        return true;
                    }
                    return false;
                }

                // Helper: Add text with word wrap
                function addWrappedText(text, x, y, maxWidth, fontSize = 11, color = darkGray, lineHeight = 1.4) {
                    doc.setFontSize(fontSize);
                    doc.setTextColor(...color);
                    // jspdf splitTextToSize automatically handles lineHeight, but we multiply by fontSize and a multiplier for spacing
                    const lines = doc.splitTextToSize(text, maxWidth);
                    doc.text(lines, x, y, {
                        lineHeightFactor: lineHeight
                    });
                    // Calculate the new Y position
                    return y + (lines.length * fontSize * lineHeight);
                }

                // Helper: Add footer to each page
                function addFooter() {
                    const footerY = pageHeight - 40;
                    doc.setFillColor(...brandPurple);
                    doc.rect(0, footerY, pageWidth, 40, 'F');
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(9);
                    doc.setFont(undefined, 'normal'); // Ensure normal font for footer
                    doc.text('© ' + new Date().getFullYear() + ' Winningtemp', margin, footerY + 20);
                    doc.text('winningtemp.com', pageWidth - margin, footerY + 20, {
                        align: 'right'
                    });
                }

                // ========== COVER PAGE ==========
                doc.setFillColor(...brandPurple);
                doc.rect(0, 0, pageWidth, pageHeight, 'F');

                // Add Winningtemp logo (as text since we can't embed images easily)
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(24);
                doc.setFont(undefined, 'bold');
                doc.text('Winningtemp', pageWidth / 2, 120, {
                    align: 'center'
                });

                doc.setFontSize(38);
                doc.setFont(undefined, 'bold');
                doc.text('Employee Engagement', pageWidth / 2, 200, {
                    align: 'center'
                });
                doc.text('Assessment Report', pageWidth / 2, 245, {
                    align: 'center'
                });

                doc.setFontSize(16);
                doc.setFont(undefined, 'normal');
                doc.text(new Date().toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                }), pageWidth / 2, 300, {
                    align: 'center'
                });

                // Result badge
                doc.setFillColor(255, 255, 255);
                // Use regular rect for compatibility
                doc.rect(pageWidth / 2 - 200, 360, 400, 80, 'F');
                doc.setTextColor(...brandPurple);
                doc.setFontSize(24);
                doc.setFont(undefined, 'bold');
                doc.text(resultsData.resultType, pageWidth / 2, 395, {
                    align: 'center'
                });
                doc.setFontSize(14);
                doc.setFont(undefined, 'normal');
                doc.text(resultsData.aCount + ' out of ' + resultsData.totalQuestions + ' A\'s', pageWidth / 2, 420, {
                    align: 'center'
                });

                doc.setTextColor(255, 255, 255);
                doc.setFontSize(11);
                doc.text('A comprehensive analysis of your organization\'s', pageWidth / 2, 520, {
                    align: 'center'
                });
                doc.text('employee engagement maturity', pageWidth / 2, 540, {
                    align: 'center'
                });

                // Next page (Results Overview)
                doc.addPage();
                currentY = 40;
                addFooter(); // Add footer to the new page

                // ========== RESULTS OVERVIEW PAGE ==========
                doc.setFont(undefined, 'bold');
                doc.setFontSize(20);
                doc.setTextColor(...darkGray);
                currentY = addWrappedText('Engagement Maturity Assessment', margin, currentY, contentWidth, 20, darkGray, 1.2);
                currentY += 15;

                // Title for score
                doc.setFont(undefined, 'normal');
                doc.setFontSize(14);
                doc.setTextColor(...mediumGray);
                currentY = addWrappedText('Your Organization\'s Maturity Level:', margin, currentY, contentWidth, 14, mediumGray, 1.2);
                currentY += 10;

                // Score block background
                doc.setFillColor(...lightPurple);
                doc.rect(margin, currentY, contentWidth, 120, 'F');

                // Result Type (Big, Colored)
                // Convert hex color to RGB for jsPDF
                const hexToRgb = (hex) => {
                    const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
                    return result ? [
                        parseInt(result[1], 16),
                        parseInt(result[2], 16),
                        parseInt(result[3], 16)
                    ] : [0, 0, 0];
                };
                doc.setTextColor(...hexToRgb(resultsData.resultColor));
                doc.setFontSize(30);
                doc.setFont(undefined, 'bold');
                doc.text(resultsData.resultType, margin + 15, currentY + 35);

                // Description
                doc.setFontSize(11);
                doc.setFont(undefined, 'normal');
                currentY = addWrappedText(resultsData.resultDescription, margin + 15, currentY + 60, contentWidth - 30, 11, darkGray, 1.3);

                // Score breakdown
                currentY = currentY + 70; // Move Y down past the description box.

                // Bar chart simulation (Simple breakdown list)
                doc.setFont(undefined, 'bold');
                doc.setFontSize(16);
                doc.setTextColor(...darkGray);
                currentY = addWrappedText('Score Breakdown:', margin, currentY, contentWidth, 16, darkGray, 1.2);
                currentY += 15;

                // Data points for the simple bar chart
                const scoreData = [{
                        label: 'Advanced (A)',
                        count: resultsData.aCount,
                        color: accentGreen
                    },
                    {
                        label: 'Developing (B)',
                        count: resultsData.bCount,
                        color: accentBlue
                    },
                    {
                        label: 'Basic (C)',
                        count: resultsData.cCount,
                        color: accentOrange
                    },
                    {
                        label: 'Minimal (D)',
                        count: resultsData.dCount,
                        color: accentRed
                    }
                ];

                const barHeight = 20;
                const totalCount = resultsData.totalQuestions;
                const barWidthMax = contentWidth * 0.7; // Max width for the bar

                scoreData.forEach(item => {
                    checkPageBreak(barHeight + 10);

                    // Label
                    doc.setFontSize(11);
                    doc.setFont(undefined, 'bold');
                    doc.setTextColor(...darkGray);
                    doc.text(`${item.label}: ${item.count} out of ${totalCount}`, margin, currentY + 12);

                    // Bar background (to show 100% width)
                    doc.setFillColor(240, 240, 240);
                    doc.rect(margin, currentY + 18, contentWidth, barHeight, 'F');

                    // Bar fill
                    const fillWidth = (item.count / totalCount) * barWidthMax;
                    doc.setFillColor(...item.color);
                    doc.rect(margin, currentY + 18, fillWidth, barHeight, 'F');

                    // Percentage text on bar
                    doc.setFontSize(10);
                    doc.setFont(undefined, 'bold');
                    doc.setTextColor(255, 255, 255); // White text
                    const percentage = ((item.count / totalCount) * 100).toFixed(0) + '%';
                    doc.text(percentage, margin + fillWidth + 5, currentY + 30); // Place text slightly after the bar end

                    currentY += barHeight + 25;
                });

                // ========== DETAILED BREAKDOWN ==========
                doc.addPage();
                currentY = 40;
                addFooter();

                doc.setFont(undefined, 'bold');
                doc.setFontSize(20);
                doc.setTextColor(...darkGray);
                currentY = addWrappedText('Detailed Question Analysis', margin, currentY, contentWidth, 20, darkGray, 1.2);
                currentY += 20;

                // Helper function to get relevant features for each question
                function getRelevantFeatures(questionIndex) {
                    const featureMappings = {
                        0: { // Survey frequency
                            features: [{
                                    name: "Pulse Surveys",
                                    url: "https://www.winningtemp.com/features#pulse-surveys"
                                },
                                {
                                    name: "Focus Surveys",
                                    url: "https://www.winningtemp.com/features#focus-surveys"
                                }
                            ]
                        },
                        1: { // Real-time dashboards
                            features: [{
                                    name: "Visual Real-time Data",
                                    url: "https://www.winningtemp.com/features#visual-real-time-data"
                                },
                                {
                                    name: "Trend Charts",
                                    url: "https://www.winningtemp.com/features#trend-charts"
                                }
                            ]
                        },
                        2: { // AI-powered recommendations
                            features: [{
                                    name: "Predictions",
                                    url: "https://www.winningtemp.com/features#predictions"
                                },
                                {
                                    name: "Learning",
                                    url: "https://www.winningtemp.com/features#learning"
                                }
                            ]
                        },
                        3: { // Response rates
                            features: [{
                                    name: "Slack & Teams Integration",
                                    url: "https://www.winningtemp.com/features#slack-teams-integration"
                                },
                                {
                                    name: "Mobile App",
                                    url: "https://www.winningtemp.com/features#mobile-app"
                                }
                            ]
                        },
                        4: { // Business outcomes connection
                            features: [{
                                    name: "Winningtemp API",
                                    url: "https://www.winningtemp.com/features#winningtemp-api"
                                },
                                {
                                    name: "Engagement Reports",
                                    url: "https://www.winningtemp.com/features#engagement-reports"
                                }
                            ]
                        },
                        5: { // Track engagement to KPIs
                            features: [{
                                    name: "Smart Benchmarking",
                                    url: "https://www.winningtemp.com/features#smart-benchmarking"
                                },
                                {
                                    name: "eNPS",
                                    url: "https://www.winningtemp.com/features#enps"
                                }
                            ]
                        },
                        6: { // HR automation
                            features: [{
                                    name: "Integration - Users and Groups",
                                    url: "https://www.winningtemp.com/features#integration-users-groups"
                                },
                                {
                                    name: "Onboarding",
                                    url: "https://www.winningtemp.com/features#onboarding"
                                }
                            ]
                        },
                        7: { // Granular insights
                            features: [{
                                    name: "Smart Segments",
                                    url: "https://www.winningtemp.com/features#smart-segments"
                                },
                                {
                                    name: "Heatmap Analysis",
                                    url: "https://www.winningtemp.com/features#heatmap-analysis"
                                }
                            ]
                        },
                        8: { // Anonymous feedback
                            features: [{
                                    name: "Anonymous 2-way Conversations",
                                    url: "https://www.winningtemp.com/features#anonymous-2-way-conversations"
                                },
                                {
                                    name: "Check-in Solution",
                                    url: "https://www.winningtemp.com/features#check-in-solution"
                                }
                            ]
                        },
                        9: { // Action recommendations
                            features: [{
                                    name: "Learning",
                                    url: "https://www.winningtemp.com/features#learning"
                                },
                                {
                                    name: "Manager & Executive Training",
                                    url: "https://www.winningtemp.com/features#manager-executive-training"
                                }
                            ]
                        },
                        10: { // Retention prediction
                            features: [{
                                    name: "Turnover Analysis",
                                    url: "https://www.winningtemp.com/features#turnover-analysis"
                                },
                                {
                                    name: "Smart Index",
                                    url: "https://www.winningtemp.com/features#smart-index"
                                }
                            ]
                        },
                        11: { // Psychological safety
                            features: [{
                                    name: "Bullying & Discrimination Alerts",
                                    url: "https://www.winningtemp.com/features#bullying-discrimination-alerts"
                                },
                                {
                                    name: "Workshop - 5 Winning Ways",
                                    url: "https://www.winningtemp.com/features#workshop-5-winning-ways"
                                }
                            ]
                        },
                        12: { // Research-based approach
                            features: [{
                                    name: "Research-based Questions",
                                    url: "https://www.winningtemp.com/features#research-based-questions"
                                },
                                {
                                    name: "Winningtemp Academy",
                                    url: "https://www.winningtemp.com/features#winningtemp-academy"
                                }
                            ]
                        }
                    };
                    return featureMappings[questionIndex] || {
                        features: []
                    };
                }

                resultsData.breakdown.forEach((item, index) => {
                    const qIndex = index + 1;
                    const questionText = `Question ${qIndex}: ${item.question}`;
                    const answerText = `Your Answer (${item.score}): ${item.selected}`;
                    const whyText = `Why it matters: ${item.why}`;
                    const relevantFeatures = getRelevantFeatures(index);

                    const neededHeight = 120; // Increased height to accommodate feature buttons
                    checkPageBreak(neededHeight);

                    // Question Title
                    doc.setFont(undefined, 'bold');
                    doc.setFontSize(12);
                    doc.setTextColor(...brandPurple);
                    currentY = addWrappedText(questionText, margin, currentY, contentWidth, 12, brandPurple, 1.2);
                    currentY += 5;

                    // Answer
                    doc.setFont(undefined, 'normal');
                    doc.setFontSize(11);
                    doc.setTextColor(...darkGray);
                    currentY = addWrappedText(answerText, margin + 10, currentY, contentWidth - 10, 11, darkGray, 1.3);
                    currentY += 5;

                    // Why it matters
                    doc.setFontSize(10);
                    doc.setTextColor(...mediumGray);
                    currentY = addWrappedText(whyText, margin + 10, currentY, contentWidth - 10, 10, mediumGray, 1.3);
                    currentY += 10;

                    // Add relevant feature buttons
                    if (relevantFeatures.features.length > 0) {
                        doc.setFontSize(9);
                        doc.setTextColor(...mediumGray);
                        doc.text('Relevant Winningtemp features:', margin + 10, currentY);
                        currentY += 15;

                        relevantFeatures.features.forEach((feature, featureIndex) => {
                            const buttonWidth = 140; // 30% smaller than demo button (200px)
                            const buttonHeight = 20;
                            const buttonX = margin + 10 + (featureIndex * (buttonWidth + 10));
                            const buttonY = currentY;
                            const borderRadius = 4;

                            // Check if button fits on current line
                            if (buttonX + buttonWidth > pageWidth - margin) {
                                currentY += 30;
                                const newButtonX = margin + 10;
                                // Button background with rounded corners
                                doc.setFillColor(...brandPurple);
                                doc.roundedRect(newButtonX, currentY, buttonWidth, buttonHeight, borderRadius, borderRadius, 'F');

                                // Button text
                                doc.setTextColor(255, 255, 255);
                                doc.setFontSize(8);
                                doc.setFont(undefined, 'bold');
                                doc.text(feature.name, newButtonX + buttonWidth / 2, currentY + buttonHeight / 2 + 3, {
                                    align: 'center'
                                });

                                // Make the button clickable
                                doc.link(newButtonX, currentY, buttonWidth, buttonHeight, {
                                    url: feature.url
                                });
                            } else {
                                // Button background with rounded corners
                                doc.setFillColor(...brandPurple);
                                doc.roundedRect(buttonX, buttonY, buttonWidth, buttonHeight, borderRadius, borderRadius, 'F');

                                // Button text
                                doc.setTextColor(255, 255, 255);
                                doc.setFontSize(8);
                                doc.setFont(undefined, 'bold');
                                doc.text(feature.name, buttonX + buttonWidth / 2, buttonY + buttonHeight / 2 + 3, {
                                    align: 'center'
                                });

                                // Make the button clickable
                                doc.link(buttonX, buttonY, buttonWidth, buttonHeight, {
                                    url: feature.url
                                });
                            }
                        });
                        currentY += 30;
                    }

                    currentY += 15; // Space between questions
                });

                // Add footer to the detailed analysis page
                addFooter();

                // ========== CALL TO ACTION PAGE ==========
                doc.addPage();
                currentY = 40;

                // CTA Title
                doc.setFont(undefined, 'bold');
                doc.setFontSize(24);
                doc.setTextColor(...darkGray);
                currentY = addWrappedText('Ready to Transform Your Employee Engagement?', margin, currentY, contentWidth, 24, darkGray, 1.2);
                currentY += 30;

                // CTA Description
                doc.setFont(undefined, 'normal');
                doc.setFontSize(14);
                doc.setTextColor(...mediumGray);
                currentY = addWrappedText('Based on your assessment results, we can help you implement a comprehensive engagement strategy that drives measurable business results.', margin, currentY, contentWidth, 14, mediumGray, 1.3);
                currentY += 40;

                // Demo booking section - longer rectangle to cover button
                doc.setFillColor(...lightPurple);
                doc.rect(margin, currentY, contentWidth, 200, 'F');
                doc.setDrawColor(...brandPurple);
                doc.setLineWidth(3);
                doc.rect(margin, currentY, contentWidth, 200, 'S');

                // Demo title
                doc.setTextColor(...brandPurple);
                doc.setFontSize(20);
                doc.setFont(undefined, 'bold');
                doc.text('Book Your Free Demo', margin + 20, currentY + 35);

                // Demo description
                doc.setFont(undefined, 'normal');
                doc.setFontSize(13);
                doc.setTextColor(...darkGray);
                currentY = addWrappedText('Schedule a personalized demo to see how Winningtemp can help your organization reach the next level of engagement maturity.', margin + 20, currentY + 60, contentWidth - 40, 13, darkGray, 1.3);
                currentY += 30;

                // Demo and Contact buttons with rounded corners
                const buttonWidth = 180;
                const buttonHeight = 35;
                const buttonSpacing = 20;
                const totalButtonWidth = (buttonWidth * 2) + buttonSpacing;
                const startX = margin + 20 + (contentWidth - 40 - totalButtonWidth) / 2; // Center the buttons
                const buttonY = currentY + 10;
                const borderRadius = 8;

                // Book Demo button
                const demoButtonX = startX;

                // Button background with rounded corners
                doc.setFillColor(...brandPurple);
                doc.roundedRect(demoButtonX, buttonY, buttonWidth, buttonHeight, borderRadius, borderRadius, 'F');

                // Button border with rounded corners
                doc.setDrawColor(...brandPurple);
                doc.setLineWidth(1);
                doc.roundedRect(demoButtonX, buttonY, buttonWidth, buttonHeight, borderRadius, borderRadius, 'S');

                // Button text
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text('Book Demo Now', demoButtonX + buttonWidth / 2, buttonY + buttonHeight / 2 + 5, {
                    align: 'center'
                });

                // Make the demo button clickable with the URL
                doc.link(demoButtonX, buttonY, buttonWidth, buttonHeight, {
                    url: 'https://www.winningtemp.com/book-a-demo'
                });

                // Contact Us button
                const contactButtonX = startX + buttonWidth + buttonSpacing;

                // Button background with rounded corners
                doc.setFillColor(...brandPurple);
                doc.roundedRect(contactButtonX, buttonY, buttonWidth, buttonHeight, borderRadius, borderRadius, 'F');

                // Button border with rounded corners
                doc.setDrawColor(...brandPurple);
                doc.setLineWidth(1);
                doc.roundedRect(contactButtonX, buttonY, buttonWidth, buttonHeight, borderRadius, borderRadius, 'S');

                // Button text
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text('Contact Us', contactButtonX + buttonWidth / 2, buttonY + buttonHeight / 2 + 5, {
                    align: 'center'
                });

                // Make the contact button clickable with the URL
                doc.link(contactButtonX, buttonY, buttonWidth, buttonHeight, {
                    url: 'https://www.winningtemp.com/contact-us'
                });

                currentY += 60; // Reduced spacing since we removed contact info

                // Add footer to the final page
                addFooter();

                // Final saving call
                doc.save('Winningtemp_Engagement_Assessment_Report.pdf');

            } catch (error) {
                console.error("Error generating PDF:", error);
                alert("Could not generate PDF. Please ensure the jspdf library is loaded correctly.");
            }
        }

        function downloadWorkbook() {
            // Check if user has provided email and consent
            if (!checkDownloadRequirements()) {
                return;
            }

            // Track workbook download
            trackWorkbookDownload();
            // Open the workbook PDF in a new tab
            window.open('https://5566319.fs1.hubspotusercontent-eu1.net/hubfs/5566319/Guides/English%20guides/Workbook%20-%20Building%20a%20business%20for%20an%20employee%20engagement%20platform.pdf', '_blank');
        }

        function checkDownloadRequirements() {
            const email = document.getElementById('results-email').value;
            const firstName = document.getElementById('first-name').value;
            const lastName = document.getElementById('last-name').value;
            const dataProcessingConsent = document.getElementById('data-processing-consent').checked;

            if (!email || !firstName || !lastName || !dataProcessingConsent) {
                alert('Please fill in all required fields (email, first name, last name) and agree to data processing (required checkbox).');
        return false;
    }
    return true;
        }

        function checkDownloadAvailability() {
            // This function now only shows downloads after successful HubSpot submission
            const downloadSection = document.getElementById('download-section');
            const mainDownloadSection = document.getElementById('main-download-section');
            const thankYouMessage = document.getElementById('thank-you-message');

            // Show thank you message and download buttons
            if (downloadSection) {
                downloadSection.style.display = 'flex';
            }
            if (thankYouMessage) {
                thankYouMessage.style.display = 'block';
            }
            if (mainDownloadSection) {
                mainDownloadSection.style.display = 'flex';
                // Update the message
                const message = mainDownloadSection.querySelector('p');
                if (message) {
                    message.textContent = 'Thank you! Your downloads are now available:';
                    message.style.color = '#059669';
                }
            }
        }

        function submitToHubSpot() {
            const email = document.getElementById('results-email').value;
            const firstName = document.getElementById('first-name').value;
            const lastName = document.getElementById('last-name').value;
            const marketingConsent = document.getElementById('marketing-consent').checked;
            const dataProcessingConsent = document.getElementById('data-processing-consent').checked;

            if (!email) {
                alert('Please enter your email address');
                return;
            }

            if (!firstName) {
                alert('Please enter your first name');
                return;
            }

            if (!lastName) {
                alert('Please enter your last name');
                return;
            }

            if (!dataProcessingConsent) {
                alert('Please agree to allow us to store and process your personal data to proceed (required field)');
                return;
            }

            // Track form submission
            trackFormSubmission(email, firstName, lastName, marketingConsent, dataProcessingConsent);

            // Submit directly to HubSpot using their API
            submitToHubSpotAPI(email, firstName, lastName, marketingConsent, dataProcessingConsent);
        }

        function submitToHubSpotAPI(email, firstName, lastName, marketingConsent, dataProcessingConsent) {
            const resultsData = generateResultsData();

            // HubSpot form submission endpoint
            const formUrl = 'https://api.hsforms.com/submissions/v3/integration/submit/5566319/332d868a-2289-4615-9461-5d9f3d6c26ca';

            // 1. Calculate the dynamic market code
            var path = window.location.pathname;
            var segments = path.split('/').filter(Boolean);
            var marketCode = segments.length > 0 ? segments[0] : 'GLOBAL';

            // 2. Gather ALL data for the GTM Listener and send via postMessage
            var quizData = {
                // CRITICAL: This is the event GTM is listening for on the parent page
                'event': 'quiz_submission',

                // Data Layer Variables from your GTM setup
                'marketPage': detectedMarket, // Dynamic variable
                'market': detectedMarket,
                'quiz_type': 'employee_engagement_assessment',
                'quiz_name': 'Employee Engagement Assessment',
                'quiz_version': '1.0',
                'page_url': window.location.href,
                'page_title': document.title,
                'lead_quality': 'high',
                'has_email': !!email,
                'has_first_name': !!firstName,
                'has_last_name': !!lastName,
                'marketing_consent': marketingConsent,
            };

            // 3. Send the consolidated data from the IFRAME to the parent window
            try {
                // This is the line that solves the cross-domain tracking issue.
                window.parent.postMessage(JSON.stringify(quizData), '*');
            } catch (e) {
                console.error("Failed to send postMessage:", e);
            }

            // 4. Prepare the data for HubSpot (The original form submission logic)
            const formData = {
                    fields: [{
                        name: 'email',
                        value: email
                    },
                    {
                        name: 'firstname',
                        value: firstName
                    },
                    {
                        name: 'lastname',
                        value: lastName
                    },
                    {
                        name: 'marketing_consent',
                        value: marketingConsent ? 'yes' : 'no'
                    },
                    {
                        name: 'data_processing_consent',
                        value: dataProcessingConsent ? 'yes' : 'no'
                    },
                    {
                        name: 'assessment_results',
                        value: JSON.stringify(resultsData)
                    },
                    {
                        name: 'utm_source',
                        value: 'engagement_assessment'
                    },
                    {
                        name: 'utm_medium',
                        value: 'pdf_download'
                    },
                    {
                        name: 'utm_campaign',
                        value: 'lead_generation'
                    }
                ],
                context: {
                    hutk: getCookie('hubspotutk'), // HubSpot tracking cookie
                    pageUri: window.location.href,
                    pageName: 'Engagement Assessment'
                }
        };

        // 5. Submit to HubSpot (Your original fetch request)
        fetch(formUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Successfully submitted to HubSpot:', data);
                checkDownloadAvailability();
            })
            .catch(error => {
                console.error('Error submitting to HubSpot:', error);
                checkDownloadAvailability();
            });
        }

        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }

        function downloadSlides() {
            const resultsData = generateResultsData();

            try {
                // Check if jsPDF is available
                if (typeof window.jspdf === 'undefined') {
                    throw new Error('jsPDF library not loaded');
                }

                const {
                    jsPDF
                } = window.jspdf;
                const doc = new jsPDF('p', 'pt', 'a4');

                // Colors matching winningtemp.com
                const brandPurple = [128, 38, 150];
                const darkGray = [16, 0, 20];
                const mediumGray = [100, 116, 139];
                const lightGray = [248, 250, 252];
                const white = [255, 255, 255];
                const green = [69, 203, 28];

                let currentY = 40;
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                const margin = 50;
                const contentWidth = pageWidth - (2 * margin);

                // Helper function to add new page if needed
                function checkPageBreak(neededHeight = 60) {
                    if (currentY + neededHeight > pageHeight - 50) {
                        doc.addPage();
                        currentY = 50;
                        return true;
                    }
                    return false;
                }

                // Helper function to add text with word wrap
                function addWrappedText(text, x, y, maxWidth, fontSize = 12, color = darkGray, fontStyle = 'normal') {
                    doc.setFontSize(fontSize);
                    doc.setFont(undefined, fontStyle);
                    doc.setTextColor(...color);
                    const lines = doc.splitTextToSize(text, maxWidth);
                    doc.text(lines, x, y);
                    return y + (lines.length * fontSize * 1.4);
                }

                // Get maturity level and color based on score
                function getMaturityLevel(aCount) {
                    const percentage = Math.round((aCount / 12) * 100);
                    let level, color, summary, actionItems = [];

                    if (aCount >= 9) { // 75% - 100%
                        level = "Advanced";
                        color = green;
                        summary = `Your organization is an Engagement Leader (${percentage}% Maturity). You utilize continuous feedback, empower managers with specific, AI-driven action plans, and actively link engagement to core business KPIs. Your focus should now be on optimizing predictive analytics and scaling your world-class practices across all departments.`;
                        actionItems = [
                            "Optimize your current AI-driven action plans for even greater efficiency and measurable ROI.",
                            "Focus on embedding Psychological Safety training at all leadership levels to maintain a high-trust, innovative culture.",
                            "Use predictive analytics to preemptively address micro-risks in high-performing teams before they escalate into turnover.",
                            "Explore advanced integration of engagement data with broader business intelligence systems."
                        ];
                    } else if (aCount >= 5) { // 42% - 75%
                        level = "Developing";
                        color = [179, 232, 24];
                        summary = `You are at a Developing level (${percentage}% Maturity). You have key systems in place, such as periodic surveys, but you are likely spending too much HR time on manual analysis. This prevents a shift from reactive measurement to continuous, proactive action, limiting manager empowerment.`;
                        actionItems = [
                            "Implement a continuous, short-pulse survey system to capture real-time feedback and increase speed.",
                            "Adopt a platform that delivers managers AI-powered, research-based actions to take immediately on their results.",
                            "Work to formally track and communicate the clear financial linkage between engagement data and business outcomes.",
                            "Reduce HR administrative time by automating data collection and reporting."
                        ];
                    } else if (aCount >= 3) { // 25% - 42%
                        level = "Basic";
                        color = [255, 160, 0];
                        summary = `Your organization is at a Basic maturity level (${percentage}% Maturity). You are aware of the need for engagement but are likely relying on infrequent, high-effort surveys that result in low response rates. This provides lagging indicators, making swift intervention nearly impossible.`;
                        actionItems = [
                            "Transition to shorter, more frequent 'pulse' surveys to improve response rates and gather timely data.",
                            "Invest in basic training for managers on interpreting engagement data and empower them to own the follow-through.",
                            "Centralize feedback channels to ensure anonymous input is safely collected and acted upon, building employee trust.",
                            "Establish a clear, single source of truth for all employee feedback."
                        ];
                    } else { // Below 25%
                        level = "Minimal";
                        color = [255, 92, 97];
                        summary = `You have a Minimal engagement strategy (${percentage}% Maturity). Feedback mechanisms are likely non-existent or purely annual, leaving leadership consistently surprised by resignations. This exposes the company to significant hidden costs of turnover and low productivity.`;
                        actionItems = [
                            "Start with a small, simple, and anonymous engagement survey to establish a baseline and open a communication channel.",
                            "Educate leadership on the 'Real Cost of Disengaged Teams' and the financial benefits of preventative action.",
                            "Prioritize building psychological safety by actively communicating how feedback will be used.",
                            "Define clear ownership for the engagement initiative within the leadership team."
                        ];
                    }

                    return {
                        level,
                        percentage,
                        color,
                        summary,
                        actionItems
                    };
                }

                const maturity = getMaturityLevel(resultsData.aCount);

                // SLIDE 1: TITLE SLIDE
                // Header with logo and title
                doc.setTextColor(...brandPurple);
                doc.setFontSize(32);
                doc.setFont(undefined, 'bold');
                doc.text('Winningtemp', margin, 100);

                // Main Title
                doc.setTextColor(...darkGray);
                doc.setFontSize(48);
                doc.setFont(undefined, 'bold');
                doc.text('Employee Engagement', margin, 160);
                doc.text('Maturity Report', margin, 220);

                // Subtitle
                doc.setTextColor(...mediumGray);
                doc.setFontSize(18);
                doc.setFont(undefined, 'normal');
                doc.text('Assessment Results & Action Plan', margin, 280);

                // Divider line
                doc.setDrawColor(...brandPurple);
                doc.setLineWidth(4);
                doc.line(margin, 320, pageWidth - margin, 320);

                // Date
                doc.setTextColor(...mediumGray);
                doc.setFontSize(14);
                doc.setFont(undefined, 'normal');
                doc.text(new Date().toLocaleDateString(), margin, 360);

                // Add new page for slide 2
                doc.addPage();
                currentY = 50;

                // SLIDE 2: MATURITY LEVEL
                // Slide title
                doc.setTextColor(...darkGray);
                doc.setFontSize(32);
                doc.setFont(undefined, 'bold');
                doc.text('Your Current Maturity Level', margin, currentY);
                currentY += 60;

                // Maturity level card
                doc.setFillColor(...white);
                doc.rect(margin, currentY, contentWidth, 200, 'F');
                doc.setDrawColor(220, 220, 220);
                doc.setLineWidth(2);
                doc.rect(margin, currentY, contentWidth, 200, 'S');

                // Maturity level text - properly spaced
                doc.setFontSize(20);
                doc.setFont(undefined, 'normal');
                doc.setTextColor(...darkGray);
                doc.text('Your organization is operating at a', margin + 40, currentY + 60);

                doc.setTextColor(...maturity.color);
                doc.setFontSize(36);
                doc.setFont(undefined, 'bold');
                doc.text(maturity.level, margin + 40, currentY + 100);

                doc.setTextColor(...darkGray);
                doc.setFontSize(20);
                doc.setFont(undefined, 'normal');
                doc.text('level of engagement maturity.', margin + 40, currentY + 150);

                // Progress bar
                const barWidth = 400;
                const barHeight = 16;
                const barX = margin + 40;
                const barY = currentY + 180;

                doc.setFillColor(240, 240, 240);
                doc.rect(barX, barY, barWidth, barHeight, 'F');

                doc.setFillColor(...maturity.color);
                doc.rect(barX, barY, (barWidth * maturity.percentage) / 100, barHeight, 'F');

                doc.setTextColor(...maturity.color);
                doc.setFontSize(28);
                doc.setFont(undefined, 'bold');
                doc.text(maturity.percentage + '%', barX + barWidth + 30, barY + 12);

                // Summary text
                currentY = addWrappedText(maturity.summary, margin + 40, currentY + 220, contentWidth - 80, 16, darkGray);
                currentY += 30;

                // Score info
                doc.setTextColor(...mediumGray);
                doc.setFontSize(16);
                doc.setFont(undefined, 'bold');
                doc.text('Total Assessment Score: ' + resultsData.aCount + ' out of ' + resultsData.totalQuestions, margin + 40, currentY + 10);

                // Add new page for slide 3
                doc.addPage();
                currentY = 50;

                // SLIDE 3: ACTION ROADMAP
                // Slide title
                doc.setTextColor(...darkGray);
                doc.setFontSize(32);
                doc.setFont(undefined, 'bold');
                doc.text('Your Actionable Roadmap', margin, currentY);
                currentY += 50;

                // Subtitle
                doc.setTextColor(...mediumGray);
                doc.setFontSize(18);
                doc.setFont(undefined, 'normal');
                currentY = addWrappedText('Focus on these critical, data-backed steps to quickly improve your maturity and drive measurable business impact.', margin, currentY, contentWidth, 18, mediumGray);
                currentY += 40;

                // Action items with purple circles and connecting lines
                maturity.actionItems.forEach((item, index) => {
                    checkPageBreak(100);

                    // Purple circle with number
                    doc.setFillColor(...brandPurple);
                    doc.circle(margin + 40, currentY + 30, 28, 'F');
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(20);
                    doc.setFont(undefined, 'bold');
                    doc.text((index + 1).toString(), margin + 40, currentY + 38, {
                        align: 'center'
                    });

                    // Vertical line (except for last item)
                    if (index < maturity.actionItems.length - 1) {
                        doc.setDrawColor(...brandPurple);
                        doc.setLineWidth(6);
                        doc.line(margin + 40, currentY + 58, margin + 40, currentY + 90);
                    }

                    // Action item text
                    doc.setTextColor(...darkGray);
                    doc.setFontSize(16);
                    doc.setFont(undefined, 'normal');
                    currentY = addWrappedText(item, margin + 90, currentY + 20, contentWidth - 130, 16, darkGray);
                    currentY += 30;
                });

                currentY += 50;

                // CALL TO ACTION SECTION
                checkPageBreak(120);

                // CTA Card with purple border
                doc.setFillColor(...white);
                doc.rect(margin, currentY, contentWidth, 120, 'F');
                doc.setDrawColor(...brandPurple);
                doc.setLineWidth(4);
                doc.rect(margin, currentY, contentWidth, 120, 'S');

                // CTA Title
                doc.setTextColor(...darkGray);
                doc.setFontSize(24);
                doc.setFont(undefined, 'bold');
                doc.text('Ready to Build a Better Workplace?', margin + 40, currentY + 40);

                // CTA Description
                doc.setFontSize(16);
                doc.setFont(undefined, 'normal');
                doc.setTextColor(...mediumGray);
                currentY = addWrappedText(`Let's walk through your personalized ${maturity.level} report and map out a tailored strategy to reach the Advanced level with Winningtemp.`, margin + 40, currentY + 70, contentWidth - 80, 16, mediumGray);
                currentY += 30;

                // CTA Button (simulated)
                doc.setFillColor(...brandPurple);
                doc.rect(margin + 40, currentY + 10, 280, 40, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(16);
                doc.setFont(undefined, 'bold');
                doc.text('Book Your Free Consultation →', margin + 180, currentY + 35, {
                    align: 'center'
                });

                // FOOTER
                currentY = pageHeight - 60;

                // Footer line
                doc.setDrawColor(...mediumGray);
                doc.setLineWidth(2);
                doc.line(margin, currentY, pageWidth - margin, currentY);

                doc.setTextColor(...mediumGray);
                doc.setFontSize(12);
                doc.setFont(undefined, 'normal');
                doc.text('© ' + new Date().getFullYear() + ' Winningtemp | The Science of Employee Engagement', margin, currentY + 25);

                // Generate and download the PDF
                const fileName = `Winningtemp_Engagement_Maturity_Slides_${maturity.level.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.pdf`;
                doc.save(fileName);

            } catch (error) {
                console.error('Slide generation error:', error);
                alert('Slide generation failed. Please try again or download the PDF report instead.');
            }
        }

        function generateResultsData() {
            const counts = {
                A: 0,
                B: 0,
                C: 0,
                D: 0
            };
            Object.values(answers).forEach(answer => {
                counts[answer]++;
            });

            const aCount = counts.A;
            let resultType = '';
            let description = '';
            let resultColor = '';

            if (aCount >= 9) {
                resultType = 'Engagement Champion';
                description = 'Your organization demonstrates advanced engagement practices with data-driven insights and predictive capabilities.';
                resultColor = '#059669';
            } else if (aCount >= 5) {
                resultType = 'Growing Foundation';
                description = 'You have solid engagement basics but opportunity to enhance real-time insights and predictive capabilities.';
                resultColor = '#0284c7';
            } else if (aCount >= 3) {
                resultType = 'Critical Gap Zone';
                description = 'Significant engagement blind spots exist that may be impacting talent retention and productivity.';
                resultColor = '#ea580c';
            } else {
                resultType = 'Urgent Action Needed';
                description = 'High risk for turnover and low performance without systematic engagement measurement.';
                resultColor = '#dc2626';
            }

            // Generate breakdown for each question
            const breakdown = questions.map((question, index) => {
                const userAnswer = answers[index];
                const selectedOption = question.options.find(opt => opt.value === userAnswer);
                return {
                    question: question.question,
                    selected: selectedOption ? selectedOption.text : 'Not answered',
                    score: userAnswer || 'N/A',
                    why: question.why
                };
            });

            return {
                resultType,
                resultDescription: description,
                resultColor,
                aCount,
                bCount: counts.B,
                cCount: counts.C,
                dCount: counts.D,
                totalQuestions: questions.length,
                counts,
                answers: answers,
                breakdown,
                completedAt: new Date().toISOString()
            };
        }

        function generatePDFContent(data) {
            let content = `WINNINGTEMP EMPLOYEE ENGAGEMENT ASSESSMENT RESULTS
================================================================

Assessment Completed: ${new Date(data.completedAt).toLocaleDateString()}
Result Category: ${data.resultType}
Score: ${data.aCount} out of ${data.totalQuestions} A's

EXECUTIVE SUMMARY
-----------------
${data.description}

DETAILED BREAKDOWN
------------------
A responses (Advanced): ${data.counts.A}
B responses (Developing): ${data.counts.B}  
C responses (Basic): ${data.counts.C}
D responses (Minimal): ${data.counts.D}

YOUR RESPONSES & ANALYSIS
-------------------------

`;

            questions.forEach((question, index) => {
                const userAnswer = data.answers[index];
                const selectedOption = question.options.find(opt => opt.value === userAnswer);

                content += `${index + 1}. ${question.question}
Your answer: (${userAnswer}) ${selectedOption ? selectedOption.text : 'Not answered'}

Why this matters: ${question.why}

Analysis: `;

                switch (userAnswer) {
                    case 'A':
                        content += 'Excellent! This indicates advanced, data-driven engagement practices.';
                        break;
                    case 'B':
                        content += 'Good foundation with room for improvement in frequency and depth of insights.';
                        break;
                    case 'C':
                        content += 'Basic approach that may be limiting your ability to retain top talent.';
                        break;
                    case 'D':
                        content += 'Significant gap that requires immediate attention to reduce turnover risk.';
                        break;
                }

                content += '\\n\\n';
            });

            content += `
PERSONALIZED RECOMMENDATIONS
-----------------------------
Based on your results, we recommend focusing on these Winningtemp features:

`;

            // Add personalized recommendations based on score
            if (data.aCount >= 9) {
                content += `• AI-Powered Predictions - Stay ahead with machine learning insights
• Advanced Benchmarking - Compare against industry leaders
• Executive Training Programs - Keep leadership at the forefront
• Custom Integration & API - Connect with existing BI systems`;
            } else if (data.aCount >= 5) {
                content += `• Real-Time Visual Results - Move to continuous pulse monitoring  
• Smart Index & Analytics - Predict turnover before it happens
• Manager Training & Support - Build data interpretation skills
• Advanced Team Structures - Support complex organizational setups`;
            } else if (data.aCount >= 3) {
                content += `• Pulse Surveys & Research-Based Questions - Replace sporadic surveys
• Automated Insights & Actions - Get AI-powered recommendations
• Anonymous 2-Way Conversations - Create psychological safety
• Onboarding & Platform Training - Quick implementation support`;
            } else {
                content += `• Complete Platform Setup - Turnkey engagement solution
• Bullying & Discrimination Alerts - Protect workforce and reduce risk
• Employee Turnover Analysis - Understand and prevent departures  
• Managed Service & Expert Support - Let experts handle the heavy lifting`;
            }

            content += `

NEXT STEPS
----------
1. Book a free demo at https://www.winningtemp.com/book-a-demo
2. Discuss your specific challenges with our engagement experts
3. Create a customized implementation plan for your organization
4. Start measuring engagement systematically within 30 days

Contact Information:
Email: info@winningtemp.com
Website: winningtemp.com

© ${new Date().getFullYear()} Winningtemp. All rights reserved.`;

            return content;
        }

        function showResults() {
            const counts = {
                A: 0,
                B: 0,
                C: 0,
                D: 0
            };
            Object.values(answers).forEach(answer => {
                counts[answer]++;
            });

            const aCount = counts.A;
            let result;

            if (aCount >= 9) {
                result = {
                    icon: '',
                    title: 'Engagement champion',
                    score: `${aCount} out of 12 A's`,
                    description: "You're leading the way! Your organization has the tools and insights to drive continuous improvement. Keep leveraging data to stay ahead.",
                    color: '#059669',
                    features: [{
                            name: 'AI-Powered Predictions',
                            description: 'Stay ahead of potential issues with machine learning insights that predict engagement trends before they impact performance.'
                        },
                        {
                            name: 'Advanced Benchmarking',
                            description: 'Compare your results against industry leaders and continuously optimize your engagement strategies.'
                        },
                        {
                            name: 'Executive Training Programs',
                            description: 'Keep your leadership team at the forefront with data-driven management techniques and advanced people analytics.'
                        },
                        {
                            name: 'Custom Integration & API',
                            description: 'Connect engagement data with your existing business intelligence systems for a complete performance picture.'
                        }
                    ]
                };
            } else if (aCount >= 5) {
                result = {
                    icon: '',
                    title: 'Growing Foundation',
                    score: `${aCount} out of 12 A's`,
                    description: "You have solid basics in place, but there's room to elevate your real-time insights, action speed, and predictive capabilities.",
                    color: '#0284c7',
                    features: [{
                            name: 'Real-Time Visual Results',
                            description: 'Move from periodic surveys to continuous pulse monitoring with instant visual dashboards and trend analysis.'
                        },
                        {
                            name: 'Smart Index & Analytics',
                            description: 'Automatically compile engagement factors that predict turnover and absenteeism before they happen.'
                        },
                        {
                            name: 'Automated Insights & Actions',
                            description: 'Get AI-powered recommendations that tell managers exactly what to focus on and how to improve team engagement.'
                        },
                        {
                            name: 'Advanced Team Structures',
                            description: 'Support complex organizational setups with matrix teams, cross-functional insights, and localized management views.'
                        }
                    ]
                };
            } else if (aCount >= 3) {
                result = {
                    icon: '',
                    title: 'Critical Gap Zone',
                    score: `${aCount} out of 12 A's`,
                    description: "Your engagement approach has significant blind spots that could be costing you talent and productivity. Time to modernize with data-driven tools.",
                    color: '#ea580c',
                    features: [{
                            name: 'Pulse Surveys & Research-Based Questions',
                            description: 'Replace sporadic surveys with scientifically-backed pulse surveys that capture real-time employee sentiment.'
                        },
                        {
                            name: 'Automated Insights & Actions',
                            description: 'Get AI-powered recommendations that tell managers exactly what to focus on and how to improve team engagement.'
                        },
                        {
                            name: 'Anonymous 2-Way Conversations',
                            description: 'Create psychological safety with secure, anonymous feedback channels that encourage honest communication.'
                        },
                        {
                            name: 'Onboarding & Platform Training',
                            description: 'Get your team up to speed quickly with comprehensive training and dedicated customer success support.'
                        }
                    ]
                };
            } else {
                result = {
                    icon: '',
                    title: 'Urgent Action Needed',
                    score: `${aCount} out of 12 A's`,
                    description: "Your organization is at high risk for turnover and low performance. Implementing a modern engagement platform should be an immediate priority.",
                    color: '#dc2626',
                    features: [{
                            name: 'Complete Platform Setup',
                            description: 'Start from scratch with a turnkey engagement solution including research-based surveys, automated analytics, and expert guidance.'
                        },
                        {
                            name: 'Bullying & Discrimination Alerts',
                            description: 'Protect your workforce and reduce legal risk with automated detection and alerting for critical workplace issues.'
                        },
                        {
                            name: 'Employee Turnover Analysis',
                            description: 'Understand why people leave and identify at-risk employees before they decide to quit, saving costly replacement expenses.'
                        },
                        {
                            name: 'Managed Service & Expert Support',
                            description: 'Let our experts handle the heavy lifting with managed services, custom surveys, and strategic consultation to get results fast.'
                        }
                    ]
                };
            }

            quizRoot.innerHTML = `
        <div style="max-width: 500px; margin: 0 auto;">
          <div style="text-align: center; margin-bottom: 20px; display: flex; flex-direction: column; align-items: center;">
            <img src="https://raw.githubusercontent.com/Nico-Winningtemp/Questionnaire/refs/heads/main/logo.svg" alt="Winningtemp" style="max-height: 78px; width: auto; margin-bottom: 15px; display: block;">
          </div>
          
          <!-- Results Card -->
          <div style="background: white; border-radius: 16px; padding: 20px; text-align: center; margin-bottom: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.08); border: 1px solid rgba(127, 38, 150, 0.1);">
            <h2 style="font-size: 24px; font-weight: 700; color: ${result.color}; margin: 0 0 8px 0;">${result.title}</h2>
            <div style="display: inline-block; background: rgba(127, 38, 150, 0.1); color: #7f2696; padding: 8px 16px; border-radius: 16px; font-size: 14px; font-weight: 600; margin-bottom: 15px;">
              ${result.score}
            </div>
            <p style="font-size: 14px; color: #64748b; line-height: 1.5; max-width: 450px; margin: 0 auto;">
              ${result.description}
            </p>
          </div>

          <!-- Score Breakdown -->
          <div style="background: white; border-radius: 16px; padding: 20px; margin-bottom: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.08); border: 1px solid rgba(127, 38, 150, 0.1);">
            <h3 style="font-size: 18px; font-weight: 600; color: #1e293b; margin: 0 0 15px 0; text-align: center;">Your Score Breakdown</h3>
            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
              ${['A', 'B', 'C', 'D'].map(letter => `
                <div style="text-align: center; background: white; padding: 12px; border-radius: 8px; border: 1px solid rgba(127, 38, 150, 0.1); box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                  <div style="display: flex; justify-content: center; align-items: center; margin-bottom: 6px;">
                    ${getSmileyIcon(letter)}
                  </div>
                  <div style="font-size: 18px; font-weight: 700; color: #7f2696; margin-bottom: 3px;">${counts[letter] || 0}</div>
                  <div style="font-size: 10px; font-weight: 600; color: #1e293b; text-transform: uppercase; letter-spacing: 1px;">${letter}'s</div>
                </div>
              `).join('')}
            </div>
          </div>

          <!-- Personalized Features Section -->
          <div style="background: #7f2696; border-radius: 16px; padding: 20px; color: white;">
            <div style="text-align: center; margin-bottom: 20px;">
              <h3 style="font-size: 20px; font-weight: 700; margin: 0 0 10px 0; color: white;">Here's How Winningtemp Can Help You</h3>
              <p style="font-size: 14px; margin: 0; opacity: 0.9; line-height: 1.5;">
                Based on your assessment results, these features will have the biggest impact on your organization:
              </p>
            </div>
            
            <div style="margin-bottom: 20px;">
              ${result.features.map((feature, index) => `
                <div style="border-bottom: 1px solid rgba(255, 255, 255, 0.2); padding: 12px 0;">
                  <button onclick="toggleFeature(${index})" style="width: 100%; text-align: left; background: none; border: none; color: white; cursor: pointer; display: flex; align-items: center; justify-content: space-between; padding: 0;">
                    <div style="display: flex; align-items: center;">
                      <img src="https://raw.githubusercontent.com/Nico-Winningtemp/Questionnaire/refs/heads/main/pinLogo.svg" style="width: 16px; height: 16px; margin-right: 8px; opacity: 0.9; filter: brightness(0) invert(1);" alt="">
                      <h4 style="font-size: 14px; font-weight: 600; margin: 0; color: white;">${feature.name}</h4>
                    </div>
                    <span id="arrow-${index}" style="font-size: 12px; transition: transform 0.3s ease;">▼</span>
                  </button>
                  <div id="feature-${index}" style="display: none; padding: 8px 0 5px 24px; opacity: 0.9; line-height: 1.4; font-size: 12px;">
                    ${feature.description}
                  </div>
                </div>
              `).join('')}
            </div>

            <!-- Share Results Section -->
            <div style="background: rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 15px; margin-bottom: 20px; text-align: center;">
              <h4 style="font-size: 16px; font-weight: 600; margin: 0 0 10px 0; color: white;">Get Your Detailed Results</h4>
              <p style="font-size: 12px; margin: 0 0 15px 0; opacity: 0.9;">Receive a comprehensive PDF report with your answers, insights, and actionable recommendations</p>
              
              <!-- Contact Form -->
              <div style="background: rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                <div style="display: flex; gap: 8px; align-items: start; justify-content: center; flex-wrap: wrap;">
                  <div style="flex-grow: 1; min-width: 200px; max-width: 300px;">
                    <!-- Name Fields Row -->
                    <div style="display: flex; gap: 8px; margin-bottom: 10px;">
                      <div style="flex: 1;">
                        <label style="display: block; font-size: 10px; font-weight: 600; margin-bottom: 3px; color: white; text-align: left;">First Name *</label>
                        <input type="text" id="first-name" placeholder="First name" style="width: 100%; padding: 8px; border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 6px; background: rgba(255, 255, 255, 0.9); color: #333; font-size: 12px;">
                      </div>
                      <div style="flex: 1;">
                        <label style="display: block; font-size: 10px; font-weight: 600; margin-bottom: 3px; color: white; text-align: left;">Last Name *</label>
                        <input type="text" id="last-name" placeholder="Last name" style="width: 100%; padding: 8px; border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 6px; background: rgba(255, 255, 255, 0.9); color: #333; font-size: 12px;">
                      </div>
                    </div>
                    
                    <!-- Email Field -->
                    <label style="display: block; font-size: 10px; font-weight: 600; margin-bottom: 3px; color: white; text-align: left;">Email Address *</label>
                    <input type="email" id="results-email" placeholder="your@email.com" style="width: 100%; padding: 8px; border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 6px; background: rgba(255, 255, 255, 0.9); color: #333; font-size: 12px; margin-bottom: 10px;">
                    
<!-- Checkbox 1: Optional Marketing Communications -->
<div style="margin-top: 10px;">
  <label style="display: flex; align-items: flex-start; gap: 6px; font-size: 10px; color: rgba(255, 255, 255, 0.8); cursor: pointer;">
    <input type="checkbox" id="marketing-consent" style="width: 14px; height: 14px; accent-color: #7f2696; margin-top: 2px; flex-shrink: 0;">
    <span>I agree to receive other communications from Winningtemp.</span>
  </label>
</div>

<!-- Checkbox 2: Mandatory Data Processing -->
<div style="margin-top: 8px; margin-bottom: 8px;">
  <label style="display: flex; align-items: flex-start; gap: 6px; font-size: 10px; color: rgba(255, 255, 255, 0.8); cursor: pointer;">
    <input type="checkbox" id="data-processing-consent" style="width: 14px; height: 14px; accent-color: #7f2696; margin-top: 2px; flex-shrink: 0;">
    <span style="line-height: 1.4;">In order to provide you the content requested, we need to store and process your personal data. If you consent to us storing your personal data for this purpose, please tick the checkbox below. <span style="color: #ff6b6b;">*</span></span>
  </label>
</div>

<!-- Privacy Policy Link -->
<div style="margin-top: 8px; font-size: 9px; color: rgba(255, 255, 255, 0.7); line-height: 1.4;">
  <span>For more information on how to unsubscribe, our privacy practices, and how we are committed to protecting and respecting your privacy, please review our <a href="https://www.winningtemp.com/privacy-notice" target="_blank" style="color: #60a5fa; text-decoration: underline;">Privacy Policy</a>.</span>
</div>
                  </div>
                  <button onclick="submitToHubSpot()" style="background: white; color: #7f2696; border: none; border-radius: 6px; padding: 8px 16px; font-size: 12px; font-weight: 600; cursor: pointer; white-space: nowrap; margin-top: 20px;">
                    Get My Results
                  </button>
                </div>
              </div>
              
              <!-- Thank You Message -->
              <div id="thank-you-message" style="display: none; text-align: center; margin: 20px 0;">
                <p style="font-family: 'Poppins', sans-serif; font-size: 16px; font-weight: 400; color: white; margin: 0; line-height: 1.4;">
                  Thank you, we hope the insights are valuable and that we can help
                </p>
                <p style="font-family: 'Poppins', sans-serif; font-size: 14px; font-weight: 500; color: white; margin: 5px 0 0 0;">
                  - Winningtemp Team
                </p>
              </div>

              <!-- Download Option -->
              <div id="download-section" style="display: none; flex-direction: column; align-items: center; gap: 10px; margin-top: 15px;">
                <div style="display: flex; justify-content: center; gap: 10px; flex-wrap: wrap;">
                  <button onclick="downloadPDF()" style="background: rgba(255, 255, 255, 0.2); color: white; border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 6px; padding: 8px 16px; font-size: 12px; cursor: pointer;">
                    Download PDF Report
                  </button>
                  <button onclick="downloadWorkbook()" style="background: rgba(255, 255, 255, 0.2); color: white; border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 6px; padding: 8px 16px; font-size: 12px; cursor: pointer;">
                    Download Workbook
                  </button>
                </div>
              </div>
            </div>

            <div style="text-align: center;">
              <button onclick="window.location.href = 'https://www.winningtemp.com/book-a-demo'" 
                      style="background: white; color: #7f2696; border: none; border-radius: 25px; padding: 12px 24px; font-size: 14px; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.15);">
                Book a Free Demo
              </button>
              <p style="margin-top: 10px; font-size: 12px; opacity: 0.8;">Get a tour of the markets most advance platform for employee listening.</p>
            </div>
          </div>
        </div>
      `;
        }

        // Event listeners

        // REMOVED: Click outside to close modal - this was causing the quiz restart issue
        // modal.addEventListener('click', function(e) {
        //     if (e.target === modal) {
        //         closeQuiz();
        //     }
        // });

        // Global functions for inline onclick
        window.startQuestions = startQuestions;
        window.selectAnswer = selectAnswer;
        window.previousQuestion = previousQuestion;
        window.toggleFeature = toggleFeature;
        window.emailResults = emailResults;
        window.downloadPDF = downloadPDF;
        window.downloadWorkbook = downloadWorkbook;
        window.submitToHubSpot = submitToHubSpot;
        window.checkDownloadAvailability = checkDownloadAvailability;
        window.shareResults = shareResults;

        // Auto-start the quiz when page loads
        document.body.style.overflow = 'hidden';
        renderIntro();

        console.log('Quiz ready!');
    </script>

    <!-- Start of HubSpot Embed Code -->
    <script type="text/javascript" id="hs-script-loader" async defer src="//js-eu1.hs-scripts.com/5566319.js"></script>
    <!-- End of HubSpot Embed Code -->
</body>

</html>
